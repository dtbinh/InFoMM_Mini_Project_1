function [E] = floquet_four_weak_amended(a,b,g,N)

% Author: Joseph Field 
% Date:   June 2017.
% Course: Mini Project One, University of Oxford.
%
% DESCRIPTION:
%     Finds the approximate integral of the Floquet linearized matrix over
%     an entire period, P.
% INPUT: 
%     a: {float} 'alpha' in the amended model (TM2).
%     b: {float} 'beta' in the amended model (TM2).
%     g: {float} 'gamma' in the amended model (TM2).
%     N:   {int} Number of matrix-exponential multiplications for the
%                approximated Floquet solution.
% OUTPUT:
%     E:   {vec} Eigenvalues of the approximated integral of the Floquet
%                linearization matrix.

%% Example
% [E] = floquet_four_weak_amended(10,10,1,1000)

%%
% Period P = 2pi/omega =2pi/(a/(b + gL)) = 2pi(b + gL)/a
L = gamma_summation(4);
P = 2*pi*(b+g*L)/a;
P_steps_V = linspace(0,P,N+1);
dt = P_steps_V(2);
P_steps_V = P_steps_V + dt/2;

R = P*b/(2*pi);
% Periodic Orbit solutions.
X1 = @(t) R*cos(t*a/b);
Y1 = @(t) R*sin(t*a/b);
X2 = @(t) R*cos(t*a/b + 2*pi/4);
Y2 = @(t) R*sin(t*a/b + 2*pi/4);
X3 = @(t) R*cos(t*a/b + 4*pi/4);
Y3 = @(t) R*sin(t*a/b + 4*pi/4);
X4 = @(t) R*cos(t*a/b + 6*pi/4);
Y4 = @(t) R*sin(t*a/b + 6*pi/4);
V1 = @(t) -1*b*sin(t*a/b);
W1 = @(t)  b*cos(t*a/b);
V2 = @(t) -1*b*sin(t*a/b + 2*pi/4);
W2 = @(t)  b*cos(t*a/b + 2*pi/4);
V3 = @(t) -1*b*sin(t*a/b + 4*pi/4);
W3 = @(t)  b*cos(t*a/b + 4*pi/4);
V4 = @(t) -1*b*sin(t*a/b + 6*pi/4);
W4 = @(t)  b*cos(t*a/b + 6*pi/4);

% Compute and multiply the matrix exponentials.
floq_A = eye(16);
for i = 1:N;
    
    % Choose the particular time-step.
    t = P_steps_V(i);
    
    % Huge definition of the monodromy matrix.
    A_approx = [0 0 0 0 0 0 0 0 1 0 0 0 0 0 0 0;
                0 0 0 0 0 0 0 0 0 1 0 0 0 0 0 0;
                0 0 0 0 0 0 0 0 0 0 1 0 0 0 0 0;
                0 0 0 0 0 0 0 0 0 0 0 1 0 0 0 0;
                0 0 0 0 0 0 0 0 0 0 0 0 1 0 0 0;
                0 0 0 0 0 0 0 0 0 0 0 0 0 1 0 0;
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0;
                0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1;
    % Row 9 : dv1dt
    a*(X1(t))^2/norm([X1(t),Y1(t)])^3 - a/norm([X1(t),Y1(t)])  - g*(-1/norm([X2(t)-X1(t),Y2(t)-Y1(t)]) + (X2(t)-X1(t))^2/norm([X2(t)-X1(t),Y2(t)-Y1(t)])^3  - 1/norm([X3(t)-X1(t),Y3(t)-Y1(t)]) + (X3(t)-X1(t))^2/norm([X3(t)-X1(t),Y3(t)-Y1(t)])^3 - 1/norm([X4(t)-X1(t),Y4(t)-Y1(t)]) + (X4(t)-X1(t))^2/norm([X4(t)-X1(t),Y4(t)-Y1(t)])^3), ...
    a*(X1(t)*Y1(t))/norm([X1(t),Y1(t)])^3 - g*((X2(t)-X1(t))*(Y2(t)-Y1(t))/norm([X2(t)-X1(t),Y2(t)-Y1(t)])^3 + (X3(t)-X1(t))*(Y3(t)-Y1(t))/norm([X3(t)-X1(t),Y3(t)-Y1(t)])^3 + (X4(t)-X1(t))*(Y4(t)-Y1(t))/norm([X4(t)-X1(t),Y4(t)-Y1(t)])^3), ...
    -g*(1/norm([X2(t)-X1(t),Y2(t)-Y1(t)]) - (X2(t)-X1(t))^2/norm([X2(t)-X1(t),Y2(t)-Y1(t)])^3), ...
    -g*( -(X2(t)-X1(t))*(Y2(t)-Y1(t))/norm([X2(t)-X1(t),Y2(t)-Y1(t)])^3), ...
    -g*(1/norm([X3(t)-X1(t),Y3(t)-Y1(t)]) - (X3(t)-X1(t))^2/norm([X3(t)-X1(t),Y3(t)-Y1(t)])^3), ...
    -g*( -(X3(t)-X1(t))*(Y3(t)-Y1(t))/norm([X3(t)-X1(t),Y3(t)-Y1(t)])^3), ...
    -g*(1/norm([X4(t)-X1(t),Y4(t)-Y1(t)]) - (X4(t)-X1(t))^2/norm([X4(t)-X1(t),Y4(t)-Y1(t)])^3) ,...
    -g*( -(X4(t)-X1(t))*(Y4(t)-Y1(t))/norm([X4(t)-X1(t),Y4(t)-Y1(t)])^3), ...
    -1, ...
    0, ...
    b*(V2(t))^2/norm([V2(t),W2(t)])^3 - b/norm([V2(t),W2(t)]), ...
    b*(V2(t)*W2(t))/norm([V2(t),W2(t)])^3, ...
    b*(V3(t))^2/norm([V3(t),W3(t)])^3 - b/norm([V3(t),W3(t)]), ...
    b*(V3(t)*W3(t))/norm([V3(t),W3(t)])^3, ...
    b*(V4(t))^2/norm([V4(t),W4(t)])^3 - b/norm([V4(t),W4(t)]), ...
    b*(V4(t)*W4(t))/norm([V4(t),W4(t)])^3;
    % Row 10 : dw1dt
    a*(X1(t)*Y1(t))/norm([X1(t),Y1(t)])^3 - g*((X2(t)-X1(t))*(Y2(t)-Y1(t))/norm([X2(t)-X1(t),Y2(t)-Y1(t)])^3 + (X3(t)-X1(t))*(Y3(t)-Y1(t))/norm([X3(t)-X1(t),Y3(t)-Y1(t)])^3 + (X4(t)-X1(t))*(Y4(t)-Y1(t))/norm([X4(t)-X1(t),Y4(t)-Y1(t)])^3) ...
    a*(Y1(t))^2/norm([X1(t),Y1(t)])^3 - a/norm([X1(t),Y1(t)])  - g*(-1/norm([X2(t)-X1(t),Y2(t)-Y1(t)]) + (Y2(t)-Y1(t))^2/norm([X2(t)-X1(t),Y2(t)-Y1(t)])^3  - 1/norm([X3(t)-X1(t),Y3(t)-Y1(t)]) + (Y3(t)-Y1(t))^2/norm([X3(t)-X1(t),Y3(t)-Y1(t)])^3 - 1/norm([X4(t)-X1(t),Y4(t)-Y1(t)]) + (Y4(t)-Y1(t))^2/norm([X4(t)-X1(t),Y4(t)-Y1(t)])^3) ...
    -g*( -(X2(t)-X1(t))*(Y2(t)-Y1(t))/norm([X2(t)-X1(t),Y2(t)-Y1(t)])^3) ...
    -g*(1/norm([X2(t)-X1(t),Y2(t)-Y1(t)]) - (Y2(t)-Y1(t))^2/norm([X2(t)-X1(t),Y2(t)-Y1(t)])^3) ...
    -g*( -(X3(t)-X1(t))*(Y3(t)-Y1(t))/norm([X3(t)-X1(t),Y3(t)-Y1(t)])^3) ...
    -g*(1/norm([X3(t)-X1(t),Y3(t)-Y1(t)]) - (Y3(t)-Y1(t))^2/norm([X3(t)-X1(t),Y3(t)-Y1(t)])^3) ...
    -g*( -(X4(t)-X1(t))*(Y4(t)-Y1(t))/norm([X4(t)-X1(t),Y4(t)-Y1(t)])^3) ...
    -g*(1/norm([X4(t)-X1(t),Y4(t)-Y1(t)]) - (Y4(t)-Y1(t))^2/norm([X4(t)-X1(t),Y4(t)-Y1(t)])^3) ...
    0 ...
    -1 ...
    b*(V2(t)*W2(t))/norm([V2(t),W2(t)])^3 ...
    b*(W2(t))^2/norm([V2(t),W2(t)])^3 - b/norm([V2(t),W2(t)]) ...
    b*(V3(t)*W3(t))/norm([V3(t),W3(t)])^3 ...
    b*(W3(t))^2/norm([V3(t),W3(t)])^3 - b/norm([V3(t),W3(t)]) ...
    b*(V4(t)*W4(t))/norm([V4(t),W4(t)])^3 ...
    b*(W4(t))^2/norm([V4(t),W4(t)])^3 - b/norm([V4(t),W4(t)]);
    % Row 11 : dv2dt
    -g*(1/norm([X1(t)-X2(t),Y1(t)-Y2(t)]) - (X1(t)-X2(t))^2/norm([X1(t)-X2(t),Y1(t)-Y2(t)])^3) ...
    -g*( -(X1(t)-X2(t))*(Y1(t)-Y2(t))/norm([X1(t)-X2(t),Y1(t)-Y2(t)])^3) ...
    a*(X2(t))^2/norm([X2(t),Y2(t)])^3 - a/norm([X2(t),Y2(t)])  - g*(-1/norm([X1(t)-X2(t),Y1(t)-Y2(t)]) + (X1(t)-X2(t))^2/norm([X1(t)-X2(t),Y1(t)-Y2(t)])^3  - 1/norm([X3(t)-X2(t),Y3(t)-Y2(t)]) + (X3(t)-X2(t))^2/norm([X3(t)-X2(t),Y3(t)-Y2(t)])^3 - 1/norm([X4(t)-X2(t),Y4(t)-Y2(t)]) + (X4(t)-X2(t))^2/norm([X4(t)-X2(t),Y4(t)-Y2(t)])^3) ...
    a*(X2(t)*Y2(t))/norm([X2(t),Y2(t)])^3 - g*((X1(t)-X2(t))*(Y1(t)-Y2(t))/norm([X1(t)-X2(t),Y1(t)-Y2(t)])^3 + (X3(t)-X2(t))*(Y3(t)-Y2(t))/norm([X3(t)-X2(t),Y3(t)-Y2(t)])^3 + (X4(t)-X2(t))*(Y4(t)-Y2(t))/norm([X4(t)-X2(t),Y4(t)-Y2(t)])^3) ...
    -g*(1/norm([X3(t)-X2(t),Y3(t)-Y2(t)]) - (X3(t)-X2(t))^2/norm([X3(t)-X2(t),Y3(t)-Y2(t)])^3) ...
    -g*( -(X3(t)-X2(t))*(Y3(t)-Y2(t))/norm([X3(t)-X2(t),Y3(t)-Y2(t)])^3) ...
    -g*(1/norm([X4(t)-X2(t),Y4(t)-Y2(t)]) - (X4(t)-X2(t))^2/norm([X4(t)-X2(t),Y4(t)-Y2(t)])^3) ...
    -g*( -(X4(t)-X2(t))*(Y4(t)-Y2(t))/norm([X4(t)-X2(t),Y4(t)-Y2(t)])^3) ...
    b*(V1(t))^2/norm([V1(t),W1(t)])^3 - b/norm([V1(t),W1(t)]) ...
    b*(V1(t)*W1(t))/norm([V1(t),W1(t)])^3 ...
    -1 ...
    0 ...
    b*(V3(t))^2/norm([V3(t),W3(t)])^3 - b/norm([V3(t),W3(t)]) ...
    b*(V3(t)*W3(t))/norm([V3(t),W3(t)])^3 ...
    b*(V4(t))^2/norm([V4(t),W4(t)])^3 - b/norm([V4(t),W4(t)]) ...
    b*(V4(t)*W4(t))/norm([V4(t),W4(t)])^3;
    % Row 12 : dw2dt
    -g*( -(X1(t)-X2(t))*(Y1(t)-Y2(t))/norm([X1(t)-X2(t),Y1(t)-Y2(t)])^3) ...
    -g*(1/norm([X1(t)-X2(t),Y1(t)-Y2(t)]) - (Y1(t)-Y2(t))^2/norm([X1(t)-X2(t),Y1(t)-Y2(t)])^3) ...
    a*(X2(t)*Y2(t))/norm([X2(t),Y2(t)])^3 - g*((X1(t)-X2(t))*(Y1(t)-Y2(t))/norm([X1(t)-X2(t),Y1(t)-Y2(t)])^3 + (X3(t)-X2(t))*(Y3(t)-Y2(t))/norm([X3(t)-X2(t),Y3(t)-Y2(t)])^3 + (X4(t)-X2(t))*(Y4(t)-Y2(t))/norm([X4(t)-X2(t),Y4(t)-Y2(t)])^3) ...
    a*(Y2(t))^2/norm([X2(t),Y2(t)])^3 - a/norm([X2(t),Y2(t)])  - g*(-1/norm([X1(t)-X2(t),Y1(t)-Y2(t)]) + (Y1(t)-Y2(t))^2/norm([X1(t)-X2(t),Y1(t)-Y2(t)])^3  - 1/norm([X3(t)-X2(t),Y3(t)-Y2(t)]) + (Y3(t)-Y2(t))^2/norm([X3(t)-X2(t),Y3(t)-Y2(t)])^3 - 1/norm([X4(t)-X2(t),Y4(t)-Y2(t)]) + (Y4(t)-Y2(t))^2/norm([X4(t)-X2(t),Y4(t)-Y2(t)])^3) ...
    -g*( -(X3(t)-X2(t))*(Y3(t)-Y2(t))/norm([X3(t)-X2(t),Y3(t)-Y2(t)])^3) ...
    -g*(1/norm([X3(t)-X2(t),Y3(t)-Y2(t)]) - (Y3(t)-Y2(t))^2/norm([X3(t)-X2(t),Y3(t)-Y2(t)])^3) ...
    -g*( -(X4(t)-X2(t))*(Y4(t)-Y2(t))/norm([X4(t)-X2(t),Y4(t)-Y2(t)])^3) ...
    -g*(1/norm([X4(t)-X2(t),Y4(t)-Y2(t)]) - (Y4(t)-Y2(t))^2/norm([X4(t)-X2(t),Y4(t)-Y2(t)])^3) ...
    b*(V1(t)*W1(t))/norm([V1(t),W1(t)])^3 ...
    b*(W1(t))^2/norm([V1(t),W1(t)])^3 - b/norm([V1(t),W1(t)]) ...
    0 ...
    -1 ...
    b*(V3(t)*W3(t))/norm([V3(t),W3(t)])^3 ...
    b*(W3(t))^2/norm([V3(t),W3(t)])^3 - b/norm([V3(t),W3(t)]) ...
    b*(V4(t)*W4(t))/norm([V4(t),W4(t)])^3 ...
    b*(W4(t))^2/norm([V4(t),W4(t)])^3 - b/norm([V4(t),W4(t)]);
    % Row 13 : dv3dt
    -g*(1/norm([X1(t)-X3(t),Y1(t)-Y3(t)]) - (X1(t)-X3(t))^2/norm([X1(t)-X3(t),Y1(t)-Y3(t)])^3), ...
    -g*( -(X1(t)-X3(t))*(Y1(t)-Y3(t))/norm([X1(t)-X3(t),Y1(t)-Y3(t)])^3), ...
    -g*(1/norm([X2(t)-X3(t),Y2(t)-Y3(t)]) - (X2(t)-X3(t))^2/norm([X2(t)-X3(t),Y2(t)-Y3(t)])^3) ...
    -g*( -(X2(t)-X3(t))*(Y2(t)-Y3(t))/norm([X2(t)-X3(t),Y2(t)-Y3(t)])^3) ...
    a*(X3(t))^2/norm([X3(t),Y3(t)])^3 - a/norm([X3(t),Y3(t)])  - g*(-1/norm([X1(t)-X3(t),Y2(t)-Y1(t)]) + (X1(t)-X3(t))^2/norm([X1(t)-X3(t),Y1(t)-Y3(t)])^3  - 1/norm([X2(t)-X3(t),Y2(t)-Y3(t)]) + (X2(t)-X3(t))^2/norm([X2(t)-X3(t),Y2(t)-Y3(t)])^3 - 1/norm([X4(t)-X3(t),Y4(t)-Y3(t)]) + (X4(t)-X3(t))^2/norm([X4(t)-X3(t),Y3(t)-Y1(t)])^3), ...
    a*(X3(t)*Y3(t))/norm([X3(t),Y3(t)])^3 - g*((X1(t)-X3(t))*(Y1(t)-Y3(t))/norm([X1(t)-X3(t),Y1(t)-Y3(t)])^3 + (X2(t)-X3(t))*(Y2(t)-Y3(t))/norm([X2(t)-X3(t),Y2(t)-Y3(t)])^3 + (X4(t)-X3(t))*(Y4(t)-Y3(t))/norm([X4(t)-X3(t),Y4(t)-Y3(t)])^3), ...
    -g*(1/norm([X4(t)-X3(t),Y4(t)-Y3(t)]) - (X4(t)-X3(t))^2/norm([X4(t)-X3(t),Y4(t)-Y3(t)])^3) ...
    -g*( -(X4(t)-X3(t))*(Y4(t)-Y3(t))/norm([X4(t)-X3(t),Y4(t)-Y3(t)])^3) ...
    b*(V1(t))^2/norm([V1(t),W1(t)])^3 - b/norm([V1(t),W1(t)]) ...
    b*(V1(t)*W1(t))/norm([V1(t),W1(t)])^3 ...
    b*(V2(t))^2/norm([V2(t),W2(t)])^3 - b/norm([V2(t),W2(t)]) ...
    b*(V2(t)*W2(t))/norm([V2(t),W2(t)])^3 ...
    -1 ...
    0 ...
    b*(V4(t))^2/norm([V4(t),W4(t)])^3 - b/norm([V4(t),W4(t)]) ...
    b*(V4(t)*W4(t))/norm([V4(t),W4(t)])^3
    % Row 14 : dw3dt
    -g*( -(X1(t)-X3(t))*(Y1(t)-Y3(t))/norm([X1(t)-X3(t),Y1(t)-Y3(t)])^3) ...
    -g*(1/norm([X1(t)-X3(t),Y1(t)-Y3(t)]) - (Y1(t)-Y3(t))^2/norm([X1(t)-X3(t),Y1(t)-Y3(t)])^3) ...
    -g*( -(X2(t)-X3(t))*(Y2(t)-Y3(t))/norm([X2(t)-X3(t),Y2(t)-Y3(t)])^3) ...
    -g*(1/norm([X2(t)-X3(t),Y2(t)-Y3(t)]) - (Y2(t)-Y3(t))^2/norm([X2(t)-X3(t),Y2(t)-Y3(t)])^3) ...
    a*(X3(t)*Y3(t))/norm([X3(t),Y3(t)])^3 - g*((X1(t)-X3(t))*(Y1(t)-Y3(t))/norm([X1(t)-X3(t),Y1(t)-Y3(t)])^3 + (X2(t)-X3(t))*(Y2(t)-Y3(t))/norm([X2(t)-X3(t),Y2(t)-Y3(t)])^3 + (X4(t)-X3(t))*(Y4(t)-Y3(t))/norm([X4(t)-X3(t),Y4(t)-Y3(t)])^3) ...
    a*(Y3(t))^2/norm([X3(t),Y3(t)])^3 - a/norm([X3(t),Y3(t)])  - g*(-1/norm([X1(t)-X3(t),Y1(t)-Y3(t)]) + (Y1(t)-Y3(t))^2/norm([X1(t)-X3(t),Y1(t)-Y3(t)])^3  - 1/norm([X2(t)-X3(t),Y2(t)-Y3(t)]) + (Y2(t)-Y3(t))^2/norm([X2(t)-X3(t),Y2(t)-Y3(t)])^3 - 1/norm([X4(t)-X3(t),Y4(t)-Y3(t)]) + (Y4(t)-Y3(t))^2/norm([X4(t)-X3(t),Y4(t)-Y3(t)])^3) ...
    -g*( -(X4(t)-X3(t))*(Y4(t)-Y3(t))/norm([X4(t)-X3(t),Y4(t)-Y3(t)])^3) ...
    -g*(1/norm([X4(t)-X3(t),Y4(t)-Y3(t)]) - (Y4(t)-Y3(t))^2/norm([X4(t)-X3(t),Y4(t)-Y3(t)])^3) ...
    b*(V1(t)*W1(t))/norm([V1(t),W1(t)])^3 ...
    b*(W1(t))^2/norm([V1(t),W1(t)])^3 - b/norm([V1(t),W1(t)]) ...
    b*(V2(t)*W2(t))/norm([V2(t),W2(t)])^3 ...
    b*(W2(t))^2/norm([V2(t),W2(t)])^3 - b/norm([V2(t),W2(t)]) ...
    0 ...
    -1 ...
    b*(V4(t)*W4(t))/norm([V4(t),W4(t)])^3 ...
    b*(W4(t))^2/norm([V4(t),W4(t)])^3 - b/norm([V4(t),W4(t)]);
    % Row 15 : dv4dt
    -g*(1/norm([X1(t)-X4(t),Y1(t)-Y4(t)]) - (X1(t)-X4(t))^2/norm([X1(t)-X4(t),Y1(t)-Y4(t)])^3) ,...
    -g*( -(X1(t)-X4(t))*(Y1(t)-Y4(t))/norm([X1(t)-X4(t),Y1(t)-Y4(t)])^3), ...
    -g*(1/norm([X2(t)-X4(t),Y2(t)-Y4(t)]) - (X2(t)-X4(t))^2/norm([X2(t)-X4(t),Y2(t)-Y4(t)])^3) ,...
    -g*( -(X2(t)-X4(t))*(Y2(t)-Y4(t))/norm([X2(t)-X4(t),Y2(t)-Y4(t)])^3), ...
    -g*(1/norm([X3(t)-X4(t),Y3(t)-Y4(t)]) - (X3(t)-X4(t))^2/norm([X3(t)-X4(t),Y3(t)-Y4(t)])^3) ,...
    -g*( -(X3(t)-X4(t))*(Y3(t)-Y4(t))/norm([X3(t)-X4(t),Y3(t)-Y4(t)])^3), ...
    a*(X4(t))^2/norm([X4(t),Y4(t)])^3 - a/norm([X4(t),Y4(t)])  - g*(-1/norm([X1(t)-X4(t),Y1(t)-Y4(t)]) + (X1(t)-X4(t))^2/norm([X1(t)-X4(t),Y1(t)-Y4(t)])^3  - 1/norm([X2(t)-X4(t),Y2(t)-Y4(t)]) + (X2(t)-X4(t))^2/norm([X2(t)-X4(t),Y2(t)-Y4(t)])^3 - 1/norm([X3(t)-X4(t),Y3(t)-Y4(t)]) + (X3(t)-X4(t))^2/norm([X3(t)-X4(t),Y3(t)-Y4(t)])^3), ...
    a*(X4(t)*Y4(t))/norm([X4(t),Y4(t)])^3 - g*((X1(t)-X4(t))*(Y1(t)-Y4(t))/norm([X1(t)-X4(t),Y1(t)-Y4(t)])^3 + (X2(t)-X4(t))*(Y2(t)-Y4(t))/norm([X2(t)-X4(t),Y2(t)-Y4(t)])^3 + (X3(t)-X4(t))*(Y3(t)-Y4(t))/norm([X3(t)-X4(t),Y3(t)-Y4(t)])^3), ...
    b*(V1(t))^2/norm([V1(t),W1(t)])^3 - b/norm([V1(t),W1(t)]) ...
    b*(V1(t)*W1(t))/norm([V1(t),W1(t)])^3 ...
    b*(V2(t))^2/norm([V2(t),W2(t)])^3 - b/norm([V2(t),W2(t)]) ...
    b*(V2(t)*W2(t))/norm([V2(t),W2(t)])^3 ...
    b*(V3(t))^2/norm([V3(t),W3(t)])^3 - b/norm([V3(t),W3(t)]) ...
    b*(V3(t)*W3(t))/norm([V3(t),W3(t)])^3 ...
    -1 ...
    0;
    
    %Row 16 : dw4dt
    -g*( -(X1(t)-X4(t))*(Y1(t)-Y4(t))/norm([X1(t)-X4(t),Y1(t)-Y4(t)])^3) ...
    -g*(1/norm([X1(t)-X4(t),Y1(t)-Y4(t)]) - (Y1(t)-Y4(t))^2/norm([X1(t)-X4(t),Y1(t)-Y4(t)])^3) ...
    -g*( -(X2(t)-X4(t))*(Y2(t)-Y4(t))/norm([X2(t)-X4(t),Y2(t)-Y4(t)])^3) ...
    -g*(1/norm([X2(t)-X4(t),Y2(t)-Y4(t)]) - (Y2(t)-Y4(t))^2/norm([X2(t)-X4(t),Y2(t)-Y4(t)])^3) ...
    -g*( -(X3(t)-X4(t))*(Y3(t)-Y4(t))/norm([X3(t)-X4(t),Y3(t)-Y4(t)])^3) ...
    -g*(1/norm([X3(t)-X4(t),Y3(t)-Y4(t)]) - (Y3(t)-Y4(t))^2/norm([X3(t)-X4(t),Y3(t)-Y4(t)])^3) ...
    a*(X4(t)*Y4(t))/norm([X4(t),Y4(t)])^3 - g*((X1(t)-X4(t))*(Y1(t)-Y4(t))/norm([X1(t)-X4(t),Y1(t)-Y4(t)])^3 + (X2(t)-X4(t))*(Y2(t)-Y4(t))/norm([X2(t)-X4(t),Y2(t)-Y4(t)])^3 + (X3(t)-X4(t))*(Y3(t)-Y4(t))/norm([X3(t)-X4(t),Y3(t)-Y4(t)])^3) ...
    a*(Y4(t))^2/norm([X4(t),Y4(t)])^3 - a/norm([X4(t),Y4(t)])  - g*(-1/norm([X1(t)-X4(t),Y1(t)-Y4(t)]) + (Y1(t)-Y4(t))^2/norm([X1(t)-X4(t),Y1(t)-Y4(t)])^3  - 1/norm([X2(t)-X4(t),Y2(t)-Y4(t)]) + (Y2(t)-Y4(t))^2/norm([X2(t)-X4(t),Y2(t)-Y4(t)])^3 - 1/norm([X3(t)-X4(t),Y3(t)-Y4(t)]) + (Y3(t)-Y4(t))^2/norm([X3(t)-X4(t),Y3(t)-Y4(t)])^3) ...
    b*(V1(t)*W1(t))/norm([V1(t),W1(t)])^3 ...
    b*(W1(t))^2/norm([V1(t),W1(t)])^3 - b/norm([V1(t),W1(t)]) ...
    b*(V2(t)*W2(t))/norm([V2(t),W2(t)])^3 ...
    b*(W2(t))^2/norm([V2(t),W2(t)])^3 - b/norm([V2(t),W2(t)]) ...
    b*(V3(t)*W3(t))/norm([V3(t),W3(t)])^3 ...
    b*(W3(t))^2/norm([V3(t),W3(t)])^3 - b/norm([V3(t),W3(t)]) ...
    0 ...
    -1];

    floq_A = expm((A_approx)*dt)*floq_A;
    if i == N
        A_eig = eig(A_approx)
    end
end

floq = floq_A
E = eig(floq_A);

%%

pos = [-1 -1 2 2];
rectangle('Position',pos,'Curvature',[1 1])
axis equal
hold on
scatter(real(E),imag(E),'xr')
xlabel('Real','interpreter','latex')
ylabel('Imag','interpreter','latex')
shg
   
end

% for i = 1:0.1:6
%     [E] = floquet_four(10^i,10,1000);
% end